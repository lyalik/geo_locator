"""
–°–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–≥–∏–æ–Ω–∞
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç EasyOCR –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö API
"""

import logging
import re
from typing import Dict, List, Any, Optional, Tuple
import cv2
import numpy as np

logger = logging.getLogger(__name__)

# –ë–∞–∑–∞ —Ä–µ–≥–∏–æ–Ω–æ–≤ –†–§ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Ü–µ–Ω—Ç—Ä–æ–≤
RUSSIAN_REGIONS = {
    '01': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–¥—ã–≥–µ—è', 'lat': 44.6098, 'lon': 40.1006},
    '02': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω', 'lat': 54.7388, 'lon': 55.9721},
    '03': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë—É—Ä—è—Ç–∏—è', 'lat': 53.5775, 'lon': 109.0380},
    '04': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ê–ª—Ç–∞–π', 'lat': 50.7114, 'lon': 86.1871},
    '05': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –î–∞–≥–µ—Å—Ç–∞–Ω', 'lat': 42.9849, 'lon': 47.5047},
    '06': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ò–Ω–≥—É—à–µ—Ç–∏—è', 'lat': 43.3169, 'lon': 45.0354},
    '07': {'name': '–ö–∞–±–∞—Ä–¥–∏–Ω–æ-–ë–∞–ª–∫–∞—Ä—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 'lat': 43.4981, 'lon': 43.5978},
    '08': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞–ª–º—ã–∫–∏—è', 'lat': 46.3087, 'lon': 44.2701},
    '09': {'name': '–ö–∞—Ä–∞—á–∞–µ–≤–æ-–ß–µ—Ä–∫–µ—Å—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 'lat': 43.7676, 'lon': 41.9269},
    '10': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–∞—Ä–µ–ª–∏—è', 'lat': 63.0763, 'lon': 32.6170},
    '11': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö–æ–º–∏', 'lat': 64.5610, 'lon': 54.3269},
    '12': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–∞—Ä–∏–π –≠–ª', 'lat': 56.5927, 'lon': 48.0356},
    '13': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–æ—Ä–¥–æ–≤–∏—è', 'lat': 54.1838, 'lon': 45.1824},
    '14': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–∞—Ö–∞ (–Ø–∫—É—Ç–∏—è)', 'lat': 66.7664, 'lon': 124.1230},
    '15': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –°–µ–≤–µ—Ä–Ω–∞—è –û—Å–µ—Ç–∏—è ‚Äî –ê–ª–∞–Ω–∏—è', 'lat': 43.0156, 'lon': 44.6821},
    '16': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω', 'lat': 55.7964, 'lon': 49.1089},
    '17': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢—ã–≤–∞', 'lat': 51.7194, 'lon': 94.4502},
    '18': {'name': '–£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 'lat': 57.0166, 'lon': 53.1994},
    '19': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –•–∞–∫–∞—Å–∏—è', 'lat': 53.7210, 'lon': 91.4425},
    '21': {'name': '–ß—É–≤–∞—à—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 'lat': 55.3791, 'lon': 47.0896},
    '22': {'name': '–ê–ª—Ç–∞–π—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 52.0406, 'lon': 84.0970},
    '23': {'name': '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 45.0392, 'lon': 38.9766},
    '24': {'name': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 64.2582, 'lon': 95.1533},
    '25': {'name': '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 45.0677, 'lon': 134.8721},
    '26': {'name': '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 45.0428, 'lon': 41.9734},
    '27': {'name': '–•–∞–±–∞—Ä–æ–≤—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 50.5504, 'lon': 136.6084},
    '28': {'name': '–ê–º—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 53.6206, 'lon': 127.5343},
    '29': {'name': '–ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 63.5648, 'lon': 43.1165},
    '30': {'name': '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 46.3497, 'lon': 48.0408},
    '31': {'name': '–ë–µ–ª–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 50.6109, 'lon': 36.5867},
    '32': {'name': '–ë—Ä—è–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 53.2434, 'lon': 34.3631},
    '33': {'name': '–í–ª–∞–¥–∏–º–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.1439, 'lon': 40.3974},
    '34': {'name': '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 50.4506, 'lon': 45.4697},
    '35': {'name': '–í–æ–ª–æ–≥–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 59.2239, 'lon': 39.8843},
    '36': {'name': '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 51.6720, 'lon': 39.1843},
    '37': {'name': '–ò–≤–∞–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 57.0015, 'lon': 41.0150},
    '38': {'name': '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.1324, 'lon': 104.2606},
    '39': {'name': '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.7104, 'lon': 20.5120},
    '40': {'name': '–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.5109, 'lon': 36.2555},
    '41': {'name': '–ö–∞–º—á–∞—Ç—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 56.8343, 'lon': 160.6095},
    '42': {'name': '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.3547, 'lon': 86.0861},
    '43': {'name': '–ö–∏—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 58.6035, 'lon': 49.6680},
    '44': {'name': '–ö–æ—Å—Ç—Ä–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 58.5974, 'lon': 42.6917},
    '45': {'name': '–ö—É—Ä–≥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.4500, 'lon': 65.3333},
    '46': {'name': '–ö—É—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 51.7373, 'lon': 36.1874},
    '47': {'name': '–õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 60.0333, 'lon': 30.3000},
    '48': {'name': '–õ–∏–ø–µ—Ü–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 52.6089, 'lon': 39.5704},
    '49': {'name': '–ú–∞–≥–∞–¥–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 62.6417, 'lon': 153.9486},
    '50': {'name': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.7, 'lon': 37.5},
    '51': {'name': '–ú—É—Ä–º–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 68.9585, 'lon': 33.0827},
    '52': {'name': '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.3287, 'lon': 44.0020},
    '53': {'name': '–ù–æ–≤–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 58.5213, 'lon': 31.2706},
    '54': {'name': '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.0415, 'lon': 82.9346},
    '55': {'name': '–û–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.9885, 'lon': 73.3242},
    '56': {'name': '–û—Ä–µ–Ω–±—É—Ä–≥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 51.7727, 'lon': 55.0988},
    '57': {'name': '–û—Ä–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 52.9651, 'lon': 36.0785},
    '58': {'name': '–ü–µ–Ω–∑–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 53.2007, 'lon': 45.0046},
    '59': {'name': '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 59.0144, 'lon': 56.2502},
    '60': {'name': '–ü—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 57.8136, 'lon': 28.3496},
    '61': {'name': '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 47.2357, 'lon': 39.7015},
    '62': {'name': '–†—è–∑–∞–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.6269, 'lon': 39.6916},
    '63': {'name': '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 53.2028, 'lon': 50.1408},
    '64': {'name': '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 51.5924, 'lon': 46.0348},
    '65': {'name': '–°–∞—Ö–∞–ª–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 50.6824, 'lon': 142.7768},
    '66': {'name': '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.8431, 'lon': 60.6454},
    '67': {'name': '–°–º–æ–ª–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.7818, 'lon': 32.0401},
    '68': {'name': '–¢–∞–º–±–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 52.7213, 'lon': 41.4523},
    '69': {'name': '–¢–≤–µ—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.8587, 'lon': 35.9176},
    '70': {'name': '–¢–æ–º—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.4977, 'lon': 84.9744},
    '71': {'name': '–¢—É–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.1961, 'lon': 37.6182},
    '72': {'name': '–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 57.1531, 'lon': 65.5343},
    '73': {'name': '–£–ª—å—è–Ω–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 54.3142, 'lon': 48.4031},
    '74': {'name': '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.1644, 'lon': 61.4368},
    '75': {'name': '–ó–∞–±–∞–π–∫–∞–ª—å—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 52.0334, 'lon': 113.4995},
    '76': {'name': '–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 57.6299, 'lon': 39.8737},
    '77': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '78': {'name': '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', 'lat': 59.9343, 'lon': 30.3351},
    '79': {'name': '–ï–≤—Ä–µ–π—Å–∫–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 48.7990, 'lon': 132.9253},
    '82': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ö—Ä—ã–º', 'lat': 45.0522, 'lon': 34.1021},
    '83': {'name': '–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥', 'lat': 67.6381, 'lon': 53.0069},
    '86': {'name': '–•–∞–Ω—Ç—ã-–ú–∞–Ω—Å–∏–π—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥', 'lat': 61.0042, 'lon': 69.0019},
    '87': {'name': '–ß—É–∫–æ—Ç—Å–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥', 'lat': 66.6622, 'lon': 170.0000},
    '89': {'name': '–Ø–º–∞–ª–æ-–ù–µ–Ω–µ—Ü–∫–∏–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –æ–∫—Ä—É–≥', 'lat': 66.5317, 'lon': 66.6141},
    '92': {'name': '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å', 'lat': 44.6167, 'lon': 33.5254},
    '95': {'name': '–ß–µ—á–µ–Ω—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 'lat': 43.3170, 'lon': 45.6984},
    '99': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '102': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω', 'lat': 54.7388, 'lon': 55.9721},
    '113': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –ú–æ—Ä–¥–æ–≤–∏—è', 'lat': 54.1838, 'lon': 45.1824},
    '116': {'name': '–†–µ—Å–ø—É–±–ª–∏–∫–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω', 'lat': 55.7964, 'lon': 49.1089},
    '121': {'name': '–ß—É–≤–∞—à—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞', 'lat': 55.3791, 'lon': 47.0896},
    '123': {'name': '–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 45.0392, 'lon': 38.9766},
    '124': {'name': '–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 64.2582, 'lon': 95.1533},
    '125': {'name': '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 45.0677, 'lon': 134.8721},
    '126': {'name': '–°—Ç–∞–≤—Ä–æ–ø–æ–ª—å—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 45.0428, 'lon': 41.9734},
    '134': {'name': '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 50.4506, 'lon': 45.4697},
    '136': {'name': '–í–æ—Ä–æ–Ω–µ–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 51.6720, 'lon': 39.1843},
    '138': {'name': '–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.1324, 'lon': 104.2606},
    '142': {'name': '–ö–µ–º–µ—Ä–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.3547, 'lon': 86.0861},
    '150': {'name': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.7, 'lon': 37.5},
    '152': {'name': '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.3287, 'lon': 44.0020},
    '154': {'name': '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.0415, 'lon': 82.9346},
    '159': {'name': '–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π', 'lat': 59.0144, 'lon': 56.2502},
    '161': {'name': '–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 47.2357, 'lon': 39.7015},
    '163': {'name': '–°–∞–º–∞—Ä—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 53.2028, 'lon': 50.1408},
    '164': {'name': '–°–∞—Ä–∞—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 51.5924, 'lon': 46.0348},
    '166': {'name': '–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 56.8431, 'lon': 60.6454},
    '174': {'name': '–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.1644, 'lon': 61.4368},
    '177': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '178': {'name': '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', 'lat': 59.9343, 'lon': 30.3351},
    '197': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '199': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '750': {'name': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.7, 'lon': 37.5},
    '777': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '790': {'name': '–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å', 'lat': 55.7, 'lon': 37.5},
    '797': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176},
    '799': {'name': '–ú–æ—Å–∫–≤–∞', 'lat': 55.7558, 'lon': 37.6176}
}


class LicensePlateDetector:
    """
    –î–µ—Ç–µ–∫—Ç–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Ä–µ–≥–∏–æ–Ω–∞ –†–§
    """
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ—Ç–µ–∫—Ç–æ—Ä–∞"""
        self.reader = None
        self._init_ocr()
        
    def _init_ocr(self):
        """–õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è EasyOCR"""
        try:
            import easyocr
            self.reader = easyocr.Reader(['ru', 'en'], gpu=False)
            logger.info("‚úÖ EasyOCR initialized for license plate detection")
        except ImportError:
            logger.warning("‚ö†Ô∏è EasyOCR not installed. Install: pip install easyocr")
            self.reader = None
        except Exception as e:
            logger.error(f"Failed to initialize EasyOCR: {e}")
            self.reader = None
    
    def detect_license_plates(self, image_path: str) -> Dict[str, Any]:
        """
        –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–∞–º –Ω–∞ —Ñ–æ—Ç–æ
        
        Args:
            image_path: –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
            
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ —Ä–µ–≥–∏–æ–Ω–∞ –∏–ª–∏ None
        """
        if not self.reader:
            return {
                'success': False,
                'error': 'EasyOCR not available'
            }
        
        try:
            # –ß–∏—Ç–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            image = cv2.imread(image_path)
            if image is None:
                return {'success': False, 'error': 'Failed to load image'}
            
            # –†–∞—Å–ø–æ–∑–Ω–∞–µ–º —Ç–µ–∫—Å—Ç
            results = self.reader.readtext(image)
            
            if not results:
                return {
                    'success': False,
                    'plates_found': 0,
                    'message': 'No text detected on image'
                }
            
            # –ò—â–µ–º –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
            detected_plates = []
            for (bbox, text, confidence) in results:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –Ω–æ–º–µ—Ä–∞
                plate_info = self._parse_russian_plate(text, confidence)
                if plate_info:
                    detected_plates.append(plate_info)
            
            if not detected_plates:
                return {
                    'success': False,
                    'plates_found': 0,
                    'message': 'No license plates detected'
                }
            
            # –ë–µ—Ä–µ–º –Ω–æ–º–µ—Ä —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é
            best_plate = max(detected_plates, key=lambda x: x['confidence'])
            
            region_code = best_plate['region']
            region_info = RUSSIAN_REGIONS.get(region_code)
            
            if not region_info:
                return {
                    'success': False,
                    'plates_found': len(detected_plates),
                    'detected_region': region_code,
                    'message': f'Unknown region code: {region_code}'
                }
            
            logger.info(f"üöó Detected license plate: {best_plate['plate']} ‚Üí {region_info['name']}")
            
            return {
                'success': True,
                'plates_found': len(detected_plates),
                'plate': best_plate['plate'],
                'region_code': region_code,
                'region_name': region_info['name'],
                'coordinates': {
                    'latitude': region_info['lat'],
                    'longitude': region_info['lon'],
                    'source': 'license_plate',
                    'confidence': best_plate['confidence'],
                    'detected_plate': best_plate['plate']
                },
                'all_plates': detected_plates
            }
            
        except Exception as e:
            logger.error(f"Error detecting license plates: {e}")
            return {
                'success': False,
                'error': str(e)
            }
    
    def _parse_russian_plate(self, text: str, confidence: float) -> Optional[Dict[str, Any]]:
        """
        –ü–∞—Ä—Å–∏–Ω–≥ —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞
        
        –§–æ—Ä–º–∞—Ç—ã:
        - –ê123–ê–ê77 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
        - –ê123–ê–ê777 (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
        - –ê 123 –ê–ê 77 (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏)
        """
        # –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
        clean_text = text.replace(' ', '').upper()
        
        # –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –Ω–æ–º–µ—Ä–æ–≤
        patterns = [
            # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: –ê123–ê–ê77
            r'^([–ê–í–ï–ö–ú–ù–û–†–°–¢–£–•])(\d{3})([–ê–í–ï–ö–ú–ù–û–†–°–¢–£–•]{2})(\d{2,3})$',
            # –° –ª–∞—Ç–∏–Ω—Å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏ (OCR –º–æ–∂–µ—Ç —Å–ø—É—Ç–∞—Ç—å)
            r'^([ABEKMHOPCTYX])(\d{3})([ABEKMHOPCTYX]{2})(\d{2,3})$'
        ]
        
        for pattern in patterns:
            match = re.match(pattern, clean_text)
            if match:
                letter1, numbers, letters2, region = match.groups()
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –±—É–∫–≤—ã (—Ä—É—Å—Å–∫–∏–µ)
                letter1 = self._normalize_letter(letter1)
                letters2 = ''.join([self._normalize_letter(l) for l in letters2])
                
                # –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä
                plate = f"{letter1}{numbers}{letters2}{region}"
                
                return {
                    'plate': plate,
                    'region': region,
                    'confidence': confidence
                }
        
        return None
    
    def _normalize_letter(self, letter: str) -> str:
        """–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ª–∞—Ç–∏–Ω—Å–∫–∏—Ö –±—É–∫–≤ –≤ —Ä—É—Å—Å–∫–∏–µ (–¥–ª—è OCR –æ—à–∏–±–æ–∫)"""
        latin_to_cyrillic = {
            'A': '–ê', 'B': '–í', 'E': '–ï', 'K': '–ö',
            'M': '–ú', 'H': '–ù', 'O': '–û', 'P': '–†',
            'C': '–°', 'T': '–¢', 'Y': '–£', 'X': '–•'
        }
        return latin_to_cyrillic.get(letter, letter)
